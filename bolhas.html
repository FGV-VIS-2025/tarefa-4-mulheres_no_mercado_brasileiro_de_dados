<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Word Cloud com GÃªnero</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>
  <script>
    // Garante compatibilidade com d3.layout.cloud
    if (!d3.layout) d3.layout = {};
    d3.layout.cloud = cloud;
  </script>
</head>
<body>
  <script>
    function bubbleChart() {
  const dataset = [
    { motivo: "RemuneraÃ§Ã£o/SalÃ¡rio", Prop_homem: 64.1791, Prop_mulher: 56.7951, Quantidade: 1660 },
    { motivo: "BenefÃ­cios", Prop_homem: 13.6194, Prop_mulher: 10.5477, Quantidade: 344 },
    { motivo: "PropÃ³sito do trabalho e da empresa", Prop_homem: 20.056, Prop_mulher: 23.1237, Quantidade: 544 },
    { motivo: "Flexibilidade de trabalho remoto", Prop_homem: 36.2873, Prop_mulher: 39.1481, Quantidade: 972 },
    { motivo: "Ambiente e clima de trabalho", Prop_homem: 18.6101, Prop_mulher: 24.5436, Quantidade: 521 },
    { motivo: "Oportunidade de aprendizado e trabalhar com referÃªncias na Ã¡rea", Prop_homem: 35.2612, Prop_mulher: 32.0487, Quantidade: 916 },
    { motivo: "Plano de carreira e oportunidades de crescimento profissional", Prop_homem: 31.9963, Prop_mulher: 32.2515, Quantidade: 847 },
    { motivo: "Maturidade da empresa em termos de tecnologia e dados", Prop_homem: 15.1586, Prop_mulher: 15.0101, Quantidade: 399 },
    { motivo: "Qualidade dos gestores e lÃ­deres", Prop_homem: 7.1362, Prop_mulher: 8.7221, Quantidade: 196 },
    { motivo: "ReputaÃ§Ã£o que a empresa tem no mercado", Prop_homem: 4.8974, Prop_mulher: 4.6653, Quantidade: 130 }
  ];

  const width = 928;
  const height = width;
  const margin = 1;
  const format = d3.format(",d");

  const color = d3.scaleOrdinal()
    .domain(["Homens", "Mulheres"])
    .range(["#1e90ff", "#ff69b4"]);

  const data = dataset.map(d => ({
    id: d.motivo,
    group: d.Prop_mulher > d.Prop_homem ? "Mulheres" : "Homens",
    value: d.Quantidade,
    Prop_homem: d.Prop_homem,
    Prop_mulher: d.Prop_mulher
  }));

  const root = d3.pack()
    .size([width - margin * 2, height - margin * 2])
    .padding(3)(
      d3.hierarchy({ children: data }).sum(d => d.value)
    );

  d3.select("svg").remove();

  const svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("viewBox", [-margin, -margin, width, height])
    .attr("style", "max-width: 100%; height: auto; font: 10px sans-serif;")
    .attr("text-anchor", "middle");

  // Tooltip
  const tooltip = d3.select("body")
    .append("div")
    .attr("id", "tooltip")
    .style("position", "absolute")
    .style("background", "white")
    .style("border", "1px solid #ccc")
    .style("padding", "8px")
    .style("border-radius", "4px")
    .style("pointer-events", "none")
    .style("display", "none")
    .style("font", "12px sans-serif");

  const node = svg.append("g")
    .selectAll("g")
    .data(root.leaves())
    .enter()
    .append("g")
    .attr("transform", d => `translate(${d.x},${d.y})`)
    .on("mouseover", (event, d) => {
      tooltip.style("display", "block")
          .html(`
            Citado por ${d.data.Prop_homem.toFixed(1)}% dos homens ðŸ‘¨<br>
            Citado por ${d.data.Prop_mulher.toFixed(1)}% das mulheres ðŸ‘©
          `);
      d3.select(event.currentTarget).select("circle")
        .attr("stroke", "#333")
        .attr("stroke-width", 2);
    })
    .on("mousemove", (event) => {
      tooltip
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 20) + "px");
    })
    .on("mouseout", (event) => {
      tooltip.style("display", "none");
      d3.select(event.currentTarget).select("circle")
        .attr("stroke", null);
    });

  node.append("circle")
    .attr("fill-opacity", 0.7)
    .attr("fill", d => color(d.data.group))
    .attr("r", d => d.r);

  // Texto do motivo com quebra de linha automÃ¡tica
  node.append("text")
    .selectAll("tspan")
    .data(d => d.data.id.split(" "))
    .enter()
    .append("tspan")
    .attr("x", 0)
    .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.35}em`)
    .text(d => d);
}

    // Exporta
    window.bubbleChart = bubbleChart;
    window.activationFunctions = [bubbleChart];

    // Ativa na carga
    bubbleChart();
  </script>
</body>
</html>
