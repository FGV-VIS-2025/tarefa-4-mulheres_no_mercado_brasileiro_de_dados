<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Word Cloud com GÃªnero</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>
  <script>
    // Garante compatibilidade com d3.layout.cloud
    if (!d3.layout) d3.layout = {};
    d3.layout.cloud = cloud;
  </script>
</head>
<body>
  <script>

d3.csv("motivos_satisfacao.csv").then(data => {
    words = data.map(d => ({
  text: d.motivo,
  size: sizeScale(d.Quantidade),
  fill: d.Prop_mulher > d.Prop_homem ? "#ff69b4" : "#1e90ff",
  Quantidade: d.Quantidade,
  Prop_homem: d.Prop_homem,
  Prop_mulher: d.Prop_mulher
}));

// console.log("123");

});
    function wordCloud() {

      // console.log(dataset);
  const dataset = [
    { motivo: "RemuneraÃ§Ã£o/SalÃ¡rio", Prop_homem: 64.1791, Prop_mulher: 56.7951, Quantidade: 1660 },
    { motivo: "BenefÃ­cios", Prop_homem: 13.6194, Prop_mulher: 10.5477, Quantidade: 344 },
    { motivo: "PropÃ³sito do trabalho e da empresa", Prop_homem: 20.056, Prop_mulher: 23.1237, Quantidade: 544 },
    { motivo: "Flexibilidade de trabalho remoto", Prop_homem: 36.2873, Prop_mulher: 39.1481, Quantidade: 972 },
    { motivo: "Ambiente e clima de trabalho", Prop_homem: 18.6101, Prop_mulher: 24.5436, Quantidade: 521 },
    { motivo: "Oportunidade de aprendizado e trabalhar com referÃªncias na Ã¡rea", Prop_homem: 35.2612, Prop_mulher: 32.0487, Quantidade: 916 },
    { motivo: "Plano de carreira e oportunidades de crescimento profissional", Prop_homem: 31.9963, Prop_mulher: 32.2515, Quantidade: 847 },
    { motivo: "Maturidade da empresa em termos de tecnologia e dados", Prop_homem: 15.1586, Prop_mulher: 15.0101, Quantidade: 399 },
    { motivo: "Qualidade dos gestores e lÃ­deres", Prop_homem: 7.1362, Prop_mulher: 8.7221, Quantidade: 196 },
    { motivo: "ReputaÃ§Ã£o que a empresa tem no mercado", Prop_homem: 4.8974, Prop_mulher: 4.6653, Quantidade: 130 }
  ];

  const width = 800;
  const height = 500;

  d3.select("svg").remove();

  const sizeScale = d3.scaleLinear()
    .domain(d3.extent(dataset, d => d.Quantidade))
    .range([10, 45]);

    const words = dataset.map(d => ({
  text: d.motivo,
  size: sizeScale(d.Quantidade),
  fill: d.Prop_mulher > d.Prop_homem ? "#ff69b4" : "#1e90ff",
  Quantidade: d.Quantidade,
  Prop_homem: d.Prop_homem,
  Prop_mulher: d.Prop_mulher
}));

  const svg = d3.select("body")
    .append("svg")
    .attr("viewBox", [0, 0, width, height])
    .attr("width", width)
    .attr("height", height)
    .style("font-family", "sans-serif")
    .style("text-anchor", "middle");

  const g = svg.append("g")
    .attr("transform", `translate(${width / 2},${height / 2})`);

  const layout = d3.layout.cloud()
    .size([width, height])
    .words(words)
    .padding(2)
    .rotate(() => 0)
    .font("sans-serif")
    .fontSize(d => d.size)
    .on("end", draw);

  layout.start();

   // Tooltip (garante que sÃ³ tenha um)
   let tooltip = d3.select("#tooltip");
  if (tooltip.empty()) {
    tooltip = d3.select("body")
      .append("div")
      .attr("id", "tooltip")
      .style("position", "absolute")
      .style("background", "rgba(0,0,0,0.8)")
      .style("color", "white")
      .style("padding", "6px 10px")
      .style("border-radius", "4px")
      .style("font-size", "14px")
      .style("pointer-events", "none")
      .style("display", "none");
  }

  function draw(words) {
    g.selectAll("text")
      .data(words)
      .enter()
      .append("text")
      .attr("font-size", d => d.size)
      .attr("fill", d => d.fill)
      .attr("transform", d => `translate(${d.x},${d.y}) rotate(${d.rotate})`)
      .text(d => d.text)
      .on("mouseover", function (event, d) {
        tooltip.style("display", "block")
          .html(`
            Citado por ${d.Prop_homem.toFixed(1)}% dos homens ðŸ‘¨<br>
            Citado por ${d.Prop_mulher.toFixed(1)}% das mulheres ðŸ‘©
          `);
      
        d3.select(this).style("fill", "#339999");
      })
      .on("mousemove", function (event) {
        tooltip
          .style("left", (event.pageX + 15) + "px")
          .style("top", (event.pageY - 20) + "px");
      })
      .on("mouseout", function (event, d) {
        tooltip.style("display", "none");
        d3.select(this).style("fill", d.color);
      });
  }
}

    // Exporta
    window.wordCloud = wordCloud;
    window.activationFunctions = [wordCloud];

    // Ativa na carga
    wordCloud();
  </script>
</body>
</html>
